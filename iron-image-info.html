<!doctype html>
<!--
Copyright 2015 Sarox

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../polymer/polymer.html">

<!--
`iron-image-info` is an element for displaying an image with a revealing information panel. It also lifts off the page when the user hovers over it.

The panel can be disabled with `panel-disabled` and the elevation can be disabled with `elevation-disabled`. Otherwise, both of these features can be disabled through the `disabled` attribute. The element's link can also be disabled through the `link-disabled` attribute or class.

Examples:

At it's most basic form the element should be used like so:

    <iron-image-info src="example.png" title="Example" info="Here's some example text, here for the sole purpose of being an example."></iron-image-info>

You can set a width and height, just like the standard `img` tag:

    <iron-image-info src="example.png" height="256" width="512"></iron-image-info>

There is also a `href` attribute that turns the `iron-image-info` into a link:

    <iron-image-info src="example.png" href="//www.example.com"></iron-image-info>

Here is an example of the `disabled` attribute:

    <iron-image-info src="example.png" disabled></iron-image-info>

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--iron-image-info-color` | Text color | `--accent-color`
`--iron-image-info-background` | Background color of the panel | `--default-primary-color`
`--iron-image-info-background-revealed` | Background color of the panel when revealed | `--default-primary-color`
`--iron-image-info-font` | Text font | `inherit`
`--iron-image-info-image` | Mixin applied to the image | `{}`
`--iron-image-info-panel-revealed` | Mixin applied to the panel when revealed | `{}`
-->
<dom-module id="iron-image-info">
	<style>
		:host {
			display: block;
			margin: 8px;
			max-width: 100%;
		}
        a[href] :host {
            cursor: pointer;
        }
		
		p {
			position: absolute;
			left: 0; bottom: 0; right: 0;
			padding: 8px; margin: 0;
			height: 19px;
			
			font-family: var(--iron-image-info-font, inherit);
			text-align: center;
			background: var(--iron-image-info-background, --default-primary-color);
			color: var(--iron-image-info-color, --accent-color);

			transition: height .2s ease, background .2s ease;
		}
		@media only screen and (min-width: 752px) {
			:host:hover p {
                @apply(--iron-image-info-panel-revealed);
				height: calc(50% - 16px);
				background: var(--iron-image-info-background-revealed, --default-primary-color);
			}
		}
        :host(.panel-disabled) p {
            display: none;
        }

        a, a:link, a:visited, a:hover, a:active {
            color: var(--iron-image-info-color, --accent-color);
            text-decoration: none;
        }
        :host(.link-disabled) a {
            pointer-events: none;
        }

		paper-material {
			border-radius: 2px;
			overflow: hidden;
		}

        img {
            @apply(--iron-image-info-image);
			transition: all .2s ease;
			max-width: 100%;
            background: var(--iron-image-info-background, --default-primary-color);
			object-fit: cover;
		}
	</style>
	
	<template>
		<paper-material animated elevation="0">
			<a href="{{href}}" target="_blank">
				<img src$="{{src}}" height$="{{height}}" width$="{{width}}" alt$="{{title}}">
				<p><b>{{title}}</b><br><br>{{info}}</p>
			</a>
		</paper-material>
	</template>
</dom-module>

<script>
	Polymer({
		is: "iron-image-info",

		properties: {
			/** The URL the element points to. */
			href: String,
			/** The URL of an image. */
			src: String,
			/** The title of the image, displayed in a small bar at the base of the image and placed on the image's alt attribute */
			title: String,
			/** Information to display in the revealing panel when the user hovers over the element. */
			info: String,
			/** Sets the width of the image. */
			width: {
				type: Number,
				observer: "_widthChanged"
			},
			/** Sets the height of the image. */
			height: {
				type: Number,
				observer: "_heightChanged"
			},

			/** Disables the revealing panel. */
			panelDisabled: {
			    type: Boolean,
			    observer: "_panelDisabledObserver"
			},
			/** Disables the elevation effect. */
			elevationDisabled: Boolean,
			/** Disables the revealing panel and elevation effect. */
			disabled: {
			    type: Boolean,
			    observer: "_disabledObserver"
			},
			/** Disables the image link if it exists. */
			linkDisabled: {
			    type: Boolean,
			    observer: "_linkDisabledObserver"
			}
		},
		_widthChanged: function (newValue, oldValue) {
			if (newValue > 720) {
				this.width = 720;
			} else if (newValue < 0) {
				this.width = 0;
			}
		},
		_heightChanged: function (newValue, oldValue) {
			if (newValue > 480) {
				this.height = 480;
			} else if (newValue < 0) {
				this.height = 0;
			}
		},
		_panelDisabledObserver: function (newValue, oldValue) {
		    this.toggleClass("panel-disabled", newValue);
		},
		_disabledObserver: function (newValue, oldValue) {
		    this.panelDisabled = newValue;
		    this.elevationDisabled = newValue;
		},
		_linkDisabledObserver: function (newValue, oldValue) {
		    this.toggleClass("link-disabled", newValue);
		},

		listeners: {
			"mouseover": "_mouseOver",
			"mouseout": "_mouseOut",
			"tap": "_onTap"
		},
		_mouseOver: function () {
		    if (!this.elevationDisabled) {
			    this.$$("paper-material").elevation = 1;
			}
		},
		_mouseOut: function () {
		    if (!this.elevationDisabled) {
			    this.$$("paper-material").elevation = 0;
			}
		},
		_onTap: function () {
			this.fire("iron-image-info-tap");
		}
	});
</script>
